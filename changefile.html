<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTMLコード変換ツール</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=JetBrains+Mono&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }

        .code-font {
            font-family: 'JetBrains Mono', monospace;
        }

        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #3b82f6;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .drop-zone {
            transition: all 0.3s ease;
            border: 2px dashed #cbd5e1;
        }

        .drop-zone.drag-over {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <header class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-slate-800 mb-2">HTMLコード変換ツール</h1>
            <p class="text-slate-600">HTMLファイルをアップロードして、ソースコードをテキストとして抽出します</p>
        </header>

        <!-- Main Card -->
        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
            <!-- Upload Area -->
            <div id="dropZone" class="drop-zone m-6 p-10 rounded-xl text-center cursor-pointer bg-slate-50 hover:bg-slate-100">
                <input type="file" id="fileInput" accept=".html,.htm" class="hidden">
                <div class="flex flex-col items-center gap-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-12 h-12 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                    </svg>
                    <div class="text-lg font-semibold text-slate-700">ファイルを選択するかドラッグ＆ドロップ</div>
                    <p class="text-sm text-slate-500">対応形式: .html, .htm</p>
                </div>
            </div>

            <!-- Loading Indicator (Hidden by default) -->
            <div id="loadingState" class="hidden px-6 py-12 flex flex-col items-center justify-center gap-4">
                <div class="loader"></div>
                <p class="text-slate-600 font-medium">ファイルを解析中...</p>
            </div>

            <!-- Result Area (Hidden by default) -->
            <div id="resultArea" class="hidden border-t border-slate-200">
                <div class="flex items-center justify-between px-6 py-4 bg-slate-50">
                    <div class="flex items-center gap-2">
                        <span class="text-sm font-semibold text-slate-700">抽出されたコード</span>
                        <span id="fileNameDisplay" class="text-xs text-slate-500 bg-white border px-2 py-0.5 rounded"></span>
                    </div>
                    <button id="copyBtn" class="flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors shadow-sm">
                        <svg id="copyIcon" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                        </svg>
                        <span id="copyBtnText">コピーする</span>
                    </button>
                </div>
                <div class="p-0">
                    <textarea id="codeDisplay" readonly class="w-full h-[500px] p-6 code-font text-sm text-slate-700 bg-white focus:outline-none resize-none" spellcheck="false"></textarea>
                </div>
            </div>
        </div>

        <!-- Notification Toast -->
        <div id="toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 px-6 py-3 bg-slate-800 text-white rounded-full text-sm font-medium shadow-lg opacity-0 transition-opacity pointer-events-none">
            コピーしました！
        </div>
    </div>

    <script>
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const loadingState = document.getElementById('loadingState');
        const resultArea = document.getElementById('resultArea');
        const codeDisplay = document.getElementById('codeDisplay');
        const fileNameDisplay = document.getElementById('fileNameDisplay');
        const copyBtn = document.getElementById('copyBtn');
        const copyBtnText = document.getElementById('copyBtnText');
        const toast = document.getElementById('toast');

        // クリックでファイル選択
        dropZone.addEventListener('click', () => fileInput.click());

        // ドラッグ＆ドロップイベント
        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, (e) => {
                e.preventDefault();
                dropZone.classList.add('drag-over');
            });
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, (e) => {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
            });
        });

        dropZone.addEventListener('drop', (e) => {
            const files = e.dataTransfer.files;
            if (files.length) handleFile(files[0]);
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length) handleFile(e.target.files[0]);
        });

        // ファイル処理ロジック
        function handleFile(file) {
            if (!file.name.match(/\.(html|htm)$/i)) {
                showToast('HTMLファイルを選択してください。');
                return;
            }

            // UI切り替え
            dropZone.classList.add('hidden');
            resultArea.classList.add('hidden');
            loadingState.classList.remove('hidden');

            const reader = new FileReader();

            reader.onload = (e) => {
                // 擬似的なローディング遅延（視覚効果のため）
                setTimeout(() => {
                    const content = e.target.result;
                    codeDisplay.value = content;
                    fileNameDisplay.textContent = file.name;

                    loadingState.classList.add('hidden');
                    resultArea.classList.remove('hidden');
                    dropZone.classList.remove('hidden');
                }, 600);
            };

            reader.onerror = () => {
                showToast('ファイルの読み込みに失敗しました。');
                loadingState.classList.add('hidden');
                dropZone.classList.remove('hidden');
            };

            reader.readAsText(file);
        }

        // コピー機能
        copyBtn.addEventListener('click', () => {
            const text = codeDisplay.value;
            if (!text) return;

            // クリップボードにコピー
            const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            
            try {
                document.execCommand('copy');
                showToast('クリップボードにコピーしました！');
                
                // ボタンの視覚フィードバック
                const originalText = copyBtnText.textContent;
                copyBtnText.textContent = '完了！';
                copyBtn.classList.replace('bg-blue-600', 'bg-green-600');
                
                setTimeout(() => {
                    copyBtnText.textContent = originalText;
                    copyBtn.classList.replace('bg-green-600', 'bg-blue-600');
                }, 2000);
            } catch (err) {
                showToast('コピーに失敗しました。');
            }
            
            document.body.removeChild(textArea);
        });

        function showToast(message) {
            toast.textContent = message;
            toast.classList.remove('opacity-0');
            setTimeout(() => {
                toast.classList.add('opacity-0');
            }, 3000);
        }
    </script>
</body>
</html>
